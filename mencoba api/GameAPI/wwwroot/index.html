<!DOCTYPE html>
<html>
<head>
    <title>Simple Game API</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 600px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        .game-board {
            width: 300px;
            height: 300px;
            border: 2px solid #333;
            background-color: #f0f0f0;
            position: relative;
            margin: 20px 0;
        }
        .player {
            width: 20px;
            height: 20px;
            background-color: blue;
            border-radius: 50%;
            position: absolute;
            transition: all 0.3s;
        }
        .controls {
            margin: 10px 0;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            cursor: pointer;
        }
        .game-info {
            background: #e0e0e0;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Simple Game Web App</h1>
    
    <div id="setupScreen">
        <h3>Start New Game</h3>
        <input type="text" id="playerName" placeholder="Enter your name" value="Player1">
        <button onclick="startGame()">Start Game</button>
    </div>
    
    <div id="gameScreen" style="display: none;">
        <div class="game-info">
            <h3>Game Info</h3>
            <p>Player: <span id="infoPlayerName">-</span></p>
            <p>Score: <span id="infoScore">0</span></p>
            <p>Position: X:<span id="infoX">0</span> Y:<span id="infoY">0</span></p>
            <p>Game ID: <span id="infoGameId" style="font-size: 12px;">-</span></p>
        </div>
        
        <div class="game-board">
            <div id="playerObject" class="player"></div>
        </div>
        
        <div class="controls">
            <h4>Movement:</h4>
            <button onclick="movePlayer(0, -1)">‚Üë Up</button><br>
            <button onclick="movePlayer(-1, 0)">‚Üê Left</button>
            <button onclick="movePlayer(1, 0)">‚Üí Right</button><br>
            <button onclick="movePlayer(0, 1)">‚Üì Down</button>
        </div>
        
        <div class="controls">
            <h4>Actions:</h4>
            <button onclick="attack()">‚öîÔ∏è Attack</button>
            <button onclick="getGameState()">üîÑ Refresh</button>
            <button onclick="resetGame()">üîÑ New Game</button>
        </div>
    </div>

    <script>
        let currentGameId = null;
        
        async function startGame() {
            const playerName = document.getElementById('playerName').value;
            
            try {
                const response = await fetch('/api/game/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(playerName)
                });
                
                if (!response.ok) throw new Error('Network error');
                
                const gameState = await response.json();
                currentGameId = gameState.gameId;
                
                // Switch to game screen
                document.getElementById('setupScreen').style.display = 'none';
                document.getElementById('gameScreen').style.display = 'block';
                
                updateGameDisplay(gameState);
                
            } catch (error) {
                alert('Error starting game: ' + error.message);
            }
        }
        
        async function movePlayer(deltaX, deltaY) {
            if (!currentGameId) return;
            
            try {
                const response = await fetch(`/api/game/${currentGameId}/move`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ deltaX, deltaY })
                });
                
                if (!response.ok) throw new Error('Move failed');
                
                const gameState = await response.json();
                updateGameDisplay(gameState);
                
            } catch (error) {
                alert('Error moving: ' + error.message);
            }
        }
        
        async function attack() {
            if (!currentGameId) return;
            
            try {
                const response = await fetch(`/api/game/${currentGameId}/attack`, {
                    method: 'POST'
                });
                
                if (!response.ok) throw new Error('Attack failed');
                
                const result = await response.json();
                await getGameState(); // Refresh game state
                alert(result.message);
                
            } catch (error) {
                alert('Error attacking: ' + error.message);
            }
        }
        
        async function getGameState() {
            if (!currentGameId) return;
            
            try {
                const response = await fetch(`/api/game/${currentGameId}`);
                
                if (!response.ok) throw new Error('Failed to get game state');
                
                const gameState = await response.json();
                updateGameDisplay(gameState);
                
            } catch (error) {
                alert('Error getting game state: ' + error.message);
            }
        }
        
        function updateGameDisplay(gameState) {
            // Update info panel
            document.getElementById('infoPlayerName').textContent = gameState.player.name;
            document.getElementById('infoScore').textContent = gameState.score;
            document.getElementById('infoX').textContent = gameState.player.positionX;
            document.getElementById('infoY').textContent = gameState.player.positionY;
            document.getElementById('infoGameId').textContent = gameState.gameId;
            
            // Update player position on board (scale for display)
            const playerElement = document.getElementById('playerObject');
            const scale = 15; // Scale factor for display
            const offset = 10; // Center offset
            
            playerElement.style.left = (gameState.player.positionX * scale + offset) + 'px';
            playerElement.style.top = (gameState.player.positionY * scale + offset) + 'px';
        }
        
        function resetGame() {
            currentGameId = null;
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('setupScreen').style.display = 'block';
        }
        
        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (!currentGameId) return;
            
            switch(e.key) {
                case 'ArrowUp': movePlayer(0, -1); break;
                case 'ArrowDown': movePlayer(0, 1); break;
                case 'ArrowLeft': movePlayer(-1, 0); break;
                case 'ArrowRight': movePlayer(1, 0); break;
                case ' ': attack(); break;
                case 'r': getGameState(); break;
            }
        });
    </script>
</body>
</html>